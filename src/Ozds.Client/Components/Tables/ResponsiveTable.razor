@namespace Ozds.Client.Components.Tables

@typeparam T
@using MudBlazor
@using Ozds.Client.Components.Models
@inherits Ozds.Client.Components.Base.OzdsComponentBase

<MudHidden Breakpoint="Breakpoint.MdAndUp">
  <MudTextField
    @bind-Value="_searchString"
    Placeholder="Search"
    Adornment="Adornment.Start"
    Immediate="true"
    AdornmentIcon="@Icons.Material.Filled.Search"
    IconSize="Size.Medium"
    Class="mt-0"/>
  @foreach (var (item, index) in Model.Select((x, i) => (x, i)))
  {
    if (!Filter(item))
    {
      continue;
    }

    <ResponsiveTableCollapse>
      <Summary>
        @if(Summary is null)
        {
          <Summary Model="item" />
        }
        else
        {
          @Summary(item)
        }
      </Summary>
      <Details>
        @if (Details is null)
        {
          <Details Model="item" />
        }
        else
        {
          @Details(item)
        }
      </Details>
    </ResponsiveTableCollapse>
  }
</MudHidden>

<MudHidden Breakpoint="Breakpoint.SmAndDown">
  <MudDataGrid
    T="T"
    MultiSelection="true"
    Items="@Model"
    SortMode="SortMode.Multiple"
    Filterable="true"
    QuickFilter="@Filter">
    <ToolBarContent>
      <MudTextField
        @bind-Value="_searchString"
        Placeholder="Search"
        Adornment="Adornment.Start"
        Immediate="true"
        AdornmentIcon="@Icons.Material.Filled.Search"
        IconSize="Size.Medium">
      </MudTextField>
    </ToolBarContent>
    <Columns>
      @if (Columns is null)
      {
        <Columns TPrefix="T" Models="@Model" />
      }
      else
      {
        @Columns
      }
    </Columns>
    <PagerContent>
      <MudDataGridPager T="T"/>
    </PagerContent>
  </MudDataGrid>
</MudHidden>
