@using MudBlazor
@using Ozds.Business.Models.Abstractions
@using Ozds.Client.Components.Base

@namespace Ozds.Client.Components.Tables

@typeparam T

@inherits OzdsComponentBase

<MudHidden Breakpoint="Breakpoint.MdAndUp">
  <MudTextField
    @bind-Value="_searchString"
    Placeholder="Search"
    Adornment="Adornment.Start"
    Immediate="true"
    AdornmentIcon="@Icons.Material.Filled.Search"
    IconSize="Size.Medium"
    Class="mt-0" />
  @foreach (var (item, index) in Model.Select((x, i) => (x, i)))
  {
    if (!Filter(item))
    {
      continue;
    }

    <MudPaper Elevation="2" Class="ma-1">
      <MudStack Spacing="0">
        <MudGrid Class="d-flex pa-2">
          @Summary(item)
        </MudGrid>

        @if (Link is { } link)
        {
          <MudItem xs="2" Class="d-flex align-center justify-end">
            <MudIconButton
              OnClick="@(() => NavigationManager.NavigateTo(link(item)))"
              Icon="@Icons.Material.Filled.RemoveRedEye"
              Color="Color.Primary"/>
          </MudItem>
        }

        <MudItem xs="2" Class="d-flex align-center justify-end">
          <MudIconButton
            Icon="@(Icons.Material.Filled.KeyboardArrowUp)"
            Color="Color.Default"
            OnClick="@(() =>
              _metadata[index] = _metadata[index] with
              {
                Expanded = !_metadata[index].Expanded
              })" />
        </MudItem>
        <MudCollapse Class="py-2" Expanded="@_metadata[index].Expanded">
          <MudStack>
            <MudDivider DividerType="DividerType.Middle" Class="mt-2"/>
            @Details(item)
          </MudStack>
        </MudCollapse>
      </MudStack>
    </MudPaper>
  }
</MudHidden>

<MudHidden Breakpoint="Breakpoint.SmAndDown">
  <MudDataGrid
    T="T"
    MultiSelection="true"
    Items="@Model"
    SortMode="SortMode.Multiple"
    Filterable="true"
    QuickFilter="@Filter">
    <ToolBarContent>
      <MudTextField
        @bind-Value="_searchString"
        Placeholder="Search"
        Adornment="Adornment.Start"
        Immediate="true"
        AdornmentIcon="@Icons.Material.Filled.Search"
        IconSize="Size.Medium">
      </MudTextField>
    </ToolBarContent>
    <Columns>
      @Columns
    </Columns>
    <PagerContent>
      <MudDataGridPager T="T"/>
    </PagerContent>
  </MudDataGrid>
</MudHidden>
