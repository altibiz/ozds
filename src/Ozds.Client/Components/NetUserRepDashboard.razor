@using Ozds.Business.Time
@using Ozds.Client.Components.Charts
@using Ozds.Business.Analysis
@using Ozds.Client.Components.Streaming
@inherits OzdsOwningComponentBase

@{
  var analysis = RepresentativeState.AnalysisBases.Analysis();
  var meters = context
    .Select(x => x.Meter)
    .DistinctBy(x => x.Id)
    .ToList();
}

<MudText Typo="Typo.h4">@T["Network user"]</MudText>

<MudHidden Breakpoint="Breakpoint.MdAndUp">
  <MudGrid Class="my-3 pa-1">
    <MudItem xs="12" Class="pa-1">
      <MudPaper Class="d-flex align-center justify-stat mud-width-full pa-1 pb-3 flex-column">
        <MudItem Class="d-flex justify-center align-center" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h6">
            @T["Current months consumption"]:
          </MudText>
        </MudItem>
        <MudContainer Class="d-flex justify-center" MaxWidth="MaxWidth.Small">
          <MudText Typo="Typo.h4">
            @(NumericString(analysis.ThisMonthConsumption.ActiveEnergy_kWh, 0)) kWh
          </MudText>
        </MudContainer>
      </MudPaper>
    </MudItem>

    <MudItem xs="12" Class="pa-1">
      <MudPaper Class="d-flex align-center justify-stat mud-width-full pa-1 pb-3 flex-column">
        <MudItem Class="d-flex justify-center align-center" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h6">
            @T["Last months consumption"]:
          </MudText>
        </MudItem>
        <MudContainer Class="d-flex justify-center" MaxWidth="MaxWidth.Small">
          <MudText Typo="Typo.h4">
            @(NumericString(analysis.LastMonthConsumption.ActiveEnergy_kWh, 0)) kWh
          </MudText>
        </MudContainer>
        <MudItem Class="d-flex justify-center align-center" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h6">
            @T["Last months invoice total"]:
          </MudText>
        </MudItem>
        <MudContainer Class="d-flex justify-center" MaxWidth="MaxWidth.Small">
          <MudText Typo="Typo.h6">
            @(analysis.LastMonthExpenses.Total_EUR == 0
              ? T["Invoice pending..."]
              : NumericString(analysis.LastMonthExpenses.Total_EUR) + " EUR")
          </MudText>
        </MudContainer>
      </MudPaper>
    </MudItem>
    <MudItem xs="12" Class="pa-1">
      <MudPaper Class="d-flex align-center justify-stat mud-width-full pa-1 pb-3 flex-column">
        <MudItem Class="d-flex justify-center align-center" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h6">
            @(T["This years consumption"] + " (kW):")
          </MudText>
        </MudItem>
        <NewMeterGraph
          Meters="@meters"
          Timestamp="@DateTimeOffset.UtcNow.GetStartOfYear()"
          Resolution="@ResolutionModel.Year"
          Measure="@MeasureModel.ActivePower"
          Multiplier="1"
          Static
          Sum />
      </MudPaper>
    </MudItem>
  </MudGrid>
</MudHidden>

<MudHidden Breakpoint="Breakpoint.SmAndDown">
  <MudGrid Class="my-3">
    <MudItem xs="4">
      <MudPaper Class="mud-width-full d-flex flex-column justify-space-between pa-4" Height="320px">
        <MudItem Class="" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h5">
            @(T["Current months consumption"] + ": ")
          </MudText>
        </MudItem>
        <MudContainer Class="d-flex align-end justify-center" MaxWidth="MaxWidth.Small">
          <MudText Typo="Typo.h1">
            @(NumericString(analysis.ThisMonthConsumption.ActiveEnergy_kWh, 0))
          </MudText>
          <MudText Typo="Typo.h4" Class="mb-3 ml-1">kWh</MudText>
        </MudContainer>
        <MudItem Class="" Style="font-size: large; font-weight: bold;color: white;">
          <MudText Typo="Typo.h6">
            _____ ______ _ __________ _______:
          </MudText>
        </MudItem>
        <MudItem Class="" Style="font-size: large; font-weight: bold;color: white;">
          <MudText Typo="Typo.h6">
            ____
          </MudText>
        </MudItem>
      </MudPaper>
    </MudItem>
    <MudItem xs="4">
      <MudPaper Class="mud-width-full d-flex flex-column justify-space-between pa-4" Height="320px">
        <MudItem Class="" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h5">
            @(T["Last months consumption"] + ": ")
          </MudText>
        </MudItem>
        <MudContainer Class="d-flex align-end justify-center" MaxWidth="MaxWidth.Small">
          <MudText Typo="Typo.h1">
            @(NumericString(analysis.LastMonthConsumption.ActiveEnergy_kWh, 0))
          </MudText>
          <MudText Typo="Typo.h4" Class="mb-3 ml-1">kWh</MudText>
        </MudContainer>
        <MudItem Class="" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h6">
            @(T["Last months invoice total"] + ": ")
          </MudText>
        </MudItem>
        <MudItem Class="" Style="font-size: large; font-weight: bold; align-self: center;">
          <MudText Typo="Typo.h5">
            @(analysis.LastMonthExpenses.Total_EUR == 0
              ? T["Invoice pending..."]
              : NumericString(analysis.LastMonthExpenses.Total_EUR) + " EUR")
          </MudText>
        </MudItem>
      </MudPaper>
    </MudItem>
    <MudItem xs="4">
      <MudPaper Class="mud-width-full pa-4" Height="320px">
        <MudItem Class="" Style="font-size: large; font-weight: bold;">
          <MudText Typo="Typo.h5">
            @(T["This years consumption"] + " (kW):")
          </MudText>
        </MudItem>
        <NewMeterGraph
          Meters="@meters"
          Timestamp="@DateTimeOffset.UtcNow.GetStartOfYear()"
          Resolution="@ResolutionModel.Year"
          Measure="@MeasureModel.ActivePower"
          Multiplier="1"
          Static
          Sum />
      </MudPaper>
    </MudItem>
  </MudGrid>
</MudHidden>

@code {
  [CascadingParameter]
  public RepresentativeState RepresentativeState { get; set; } = default!;
}
