@using MudBlazor
@using Ozds.Business.Models
@using Ozds.Business.Models.Complex
@using Ozds.Client.Components.Models.Base

@typeparam TPrefix
@typeparam TModel where TModel : SchneideriEM3xxxMeasurementModel
@inherits OzdsColumnsComponentBase<TPrefix, TModel>

<PropertyColumn
  T="TPrefix"
  TProperty="string"
  Property="x => Fix(x)!.MeterId"
  Title='@Translate("Meter ID")'>
  <CellTemplate>
    <MudText>@Fix(context.Item)?.MeterId</MudText>
  </CellTemplate>
</PropertyColumn>

<PropertyColumn
  T="TPrefix"
  TProperty="DateTimeOffset"
  Property="x => Fix(x)!.Timestamp"
  Title='@Translate("Timestamp")'>
  <CellTemplate>
    <MudText>@DateTimeString(Fix(context.Item)?.Timestamp)</MudText>
  </CellTemplate>
</PropertyColumn>

<PropertyColumn
  T="TPrefix"
  TProperty="decimal"
  Property="x => TotalActivePower_W(Fix(x)!) / 1000"
  Title='@Translate("Active Power (W)")'>
  <CellTemplate>
    <MudText>
      @NumericString(TotalActivePower_W(Fix(context.Item)!) / 1000)
    </MudText>
  </CellTemplate>
</PropertyColumn>

<PropertyColumn
  T="TPrefix"
  TProperty="decimal"
  Property="x => Fix(x)!.ActiveEnergyTotalImportT0_Wh"
  Title='@Translate("Active Energy Import T0 (kWh)")'>
  <CellTemplate>
    <MudText>@NumericString(Fix(context.Item)?.ActiveEnergyTotalImportT0_Wh / 1000)</MudText>
  </CellTemplate>
</PropertyColumn>

@code {
  private decimal TotalActivePower_W(SchneideriEM3xxxMeasurementModel model)
  {
    return model.ActivePowerL1NetT0_W +
           model.ActivePowerL2NetT0_W +
           model.ActivePowerL3NetT0_W;
  }
}
