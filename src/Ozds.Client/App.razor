@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Ozds.Client.Components.Layout
@using Ozds.Client.Components.Providers
@using Ozds.Client.Components.Streaming
@using System.Globalization

@namespace Ozds.Client

@inject NavigationManager NavigationManager

@{
  var culture = Culture is null ? null : new CultureInfo(Culture);
}

<CultureStateProvider Culture="@culture">
  <UserStateProvider LogoutToken="@LogoutToken">
    <RepresentativeStateProvider>
      <Found>
        <Router AppAssembly="@typeof(App).Assembly">
          <Found Context="routeData">
            <LocationStateProvider>
              <NotificationsStateProvider>
                <AnalysisStateProvider>
                  <RouteView
                    RouteData="@routeData"
                    DefaultLayout="@typeof(Layout)" />
                </AnalysisStateProvider>
              </NotificationsStateProvider>
            </LocationStateProvider>
          </Found>
          <NotFound>
            <LayoutView Layout="@typeof(Layout)">
              <NotFound />
            </LayoutView>
          </NotFound>
        </Router>
      </Found>
      <NotFound>
        @if (NavigationManager.Uri.ToString() != "/unapproved")
        {
          NavigationManager.NavigateTo("/unapproved");
          return;
        }

        <Router AppAssembly="@typeof(App).Assembly">
          <Found Context="routeData">
            <RouteView
              RouteData="@routeData"
              DefaultLayout="@typeof(Layout)" />
          </Found>
          <NotFound>
            <LayoutView Layout="@typeof(Layout)">
              <NotFound />
            </LayoutView>
          </NotFound>
        </Router>
      </NotFound>
    </RepresentativeStateProvider>
  </UserStateProvider>
</CultureStateProvider>

@code {
  [Parameter]
  public string? Culture { get; set; } = default!;

  [Parameter]
  public string LogoutToken { get; set; } = default!;
}
