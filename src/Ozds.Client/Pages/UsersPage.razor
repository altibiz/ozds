@using Microsoft.Extensions.DependencyInjection
@using MudBlazor
@using Ozds.Business.Queries
@using Ozds.Client.Attributes
@using Ozds.Client.Components.Base
@using Ozds.Business.Models.Enums
@using Ozds.Client.Components.Streaming

@namespace Ozds.Client.Pages

@page "/users"

@attribute [Navigation(
  Title = "Users",
  Allows = new[] { RoleModel.OperatorRepresentative })]

@inherits OzdsOwningComponentBase

<Paging PageAsync="@((page) => ScopedServices
  .GetRequiredService<RepresentativeQueries>()
  .MaybeRepresentingUsers(page, CancellationToken.None))">
  <Summary>
    @{
      var href = $"user/{context.User.Id}";
      var editHref = $"user/{context.User.Id}/edit";

      <MudCard>
        <MudCardContent>
          <MudText Typo="Typo.h6">
            @context.User.UserName
          </MudText>
          <MudText>
            @context.User.Email
          </MudText>
        </MudCardContent>
        <MudCardActions>
          <MudNavLink Href="@href">
            Details
          </MudNavLink>
          <MudNavLink Href="@editHref">
            Edit
          </MudNavLink>
        </MudCardActions>
      </MudCard>
    }
  </Summary>
</Paging>

@code {
  private int _page = 1;
}
